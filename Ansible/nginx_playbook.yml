---
- name: = = = Install Nginx = = =
  hosts: NGINX

  tasks:
    - name: = = = Ensure Nginx ist latest = = =
      apt:
        name: nginx
        state: present
        update_cache: yes
      become: yes

    - name: = = = Create flaskapp.conf = = =
      copy:
        dest: /etc/nginx/conf.d/flaskapp.conf
        content: |
            server {
                listen 80;
                server_name {{ NGINX_IP }};

                location / {
                    proxy_set_header   Host                 $host;
                    proxy_set_header   X-Real-IP            $remote_addr;
                    proxy_set_header   X-Forwarded-For      $proxy_add_x_forwarded_for;
                    proxy_set_header   X-Forwarded-Proto    $scheme;
                    proxy_set_header Host $http_host;

                    proxy_pass http://{{ APP_IP }}:5000;
                }
            }
      become: yes

    - name: = = = Start Nginx = = =
      service:
        name: nginx
        state: started

